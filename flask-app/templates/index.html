{% extends "base.html" %}

{% block title %}SecureBank - Home{% endblock %}

{% block content %}
<div style="text-align: center; padding: 4rem 0;">
    <h1
        style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, #00ff88, #00ccff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        Welcome
    </h1>

    {% if not user %}
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 2rem;">
        <a href="/signin" class="btn btn-primary">Sign In</a>
        <a href="/signup" class="btn btn-secondary">Sign Up</a>
    </div>
    {% endif %}
</div>

{% if user %}
<!-- Secret Command Terminal for logged in users -->
<div
    style="max-width: 600px; margin: 2rem auto; padding: 2rem; background: rgba(0,0,0,0.4); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 12px;">
    <h3 style="color: #00ff88; margin-bottom: 1rem; text-align: center;">üîê Enter command to access secret file</h3>

    <form id="command-form" style="display: flex; gap: 1rem;">
        <input type="text" id="command-input" name="command" placeholder="Type command here..."
            style="flex: 1; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #00ff88; border-radius: 8px; color: #00ff88; font-family: monospace; font-size: 1rem;"
            autocomplete="off">
        <button type="submit" class="btn btn-primary" style="padding: 12px 24px;">Execute</button>
    </form>

    <div id="command-result"
        style="margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px; font-family: monospace; color: #888; display: none;">
    </div>
</div>

<script>
    document.getElementById('command-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const command = document.getElementById('command-input').value.trim();
        const resultDiv = document.getElementById('command-result');

        if (!command) return;

        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<span style="color: #00aaff;">Processing command...</span>';

        try {
            const response = await fetch('/api/command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ command: command })
            });

            const data = await response.json();

            if (data.success) {
                let html = '<span style="color: #00ff88;">' + data.message + '</span>';
                if (data.download_url) {
                    html += '<br><a href="' + data.download_url + '" download style="display:inline-block;margin-top:10px;padding:8px 16px;background:#00ff88;color:#000;text-decoration:none;border-radius:5px;font-weight:bold;">‚¨áÔ∏è Download Secret File</a>';
                }
                resultDiv.innerHTML = html;
            } else {
                resultDiv.innerHTML = '<span style="color: #ff6666;">' + data.message + '</span>';
            }
        } catch (error) {
            resultDiv.innerHTML = '<span style="color: #ff6666;">Error: Connection failed</span>';
        }

        document.getElementById('command-input').value = '';
    });
</script>
{% endif %}
{% endblock %}